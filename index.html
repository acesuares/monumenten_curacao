<!DOCTYPE html> 
<html> 
	<head> 
	<title>Monumentenapp</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /> 
	<link rel="stylesheet" href="style.css" />
	<link rel="stylesheet" href="leaflet.css" />
	<link rel="stylesheet" href="themes/monumenten-app.css" />
	<!-- <link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.min.css" /> -->
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile.structure-1.3.2.min.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="map.js"></script>
	<script src="leaflet.js"></script>

  
  <script>
    function onFeatureClick(e) {
 		// Feature properties of marker:
 		var properties = e.target.options.properties;

 		$('#infoHeader').html(e.target.options.properties.name);
 		$('#infoContent').html(e.target.options.properties.characteristics)
		
 		var str = e.target.options.properties.photo_url;
 		var n = str.replace( "http://www.curacaomonuments.org","http://199.236.83.254" );

 		$("#infoImage").attr("src", n);
 		$(location).attr('href', '#info');
 	}

  function populateList(id, data, htmlFunction) {
    d3.select(id).selectAll("li") 
        .data(data.features)
      .enter().append("li")
        .attr("data-theme", "a")
        .on("click", function(d) { 
          $('#infoHeader').html(d.properties.name);
          $('#infoContent').html(d.properties.characteristics)

          var str = d.properties.photo_url;
          var n = str.replace( "http://www.curacaomonuments.org","http://199.236.83.254" );
	
          $("#infoImage").attr("src", n);
          $(location).attr('href', '#info');				
        })
      .append("a")
        .attr("href", "#mapIndex")
        .attr("data-transition", "slide")
        .html(htmlFunction);
   }

   $(document).ready(function() {

      initMap();
     $.getJSON('https://rawgithub.com/bertspaan/monumenten_curacao/master/monuments.json', function(data) {
        populateList("#monument-list", data, function(d) {return d.properties.name; });
 			addMapData('monuments', data);					
      });
     
      $.getJSON('https://rawgithub.com/bertspaan/monumenten_curacao/master/museums.json', function(data) {
        populateList("#museum-list", data, function(d) {return d.properties.name; });
        addMapData('museums', data);
      });
      
  	
      // $.getJSON('https://rawgithub.com/bertspaan/monumenten_curacao/master/routes.json', function(data) {
      //   populateList("#route-list", data, function(d) {return d.properties.name; });
      //   addMapData('routes', data);
      // });
    });
  </script>

	<link rel="stylesheet" href="MarkerCluster.css" />
	<link rel="stylesheet" href="MarkerCluster.Default.css" />
	<script src="leaflet.markercluster-src.js"></script>
</head> 
<body> 
  
  <div data-role="page" data-theme="a" id="mapIndex">
 	  <div data-role="header" data-position="fixed" data-tap-toggle="false" data-fullscreen="false" data-theme="a">
 		  <a href="#list" data-icon="check" data-transition="slide">List</a>
      <h1>Monumenten</h1>
 	  </div>
    <div data-role="content" data-theme="a">	
      <div id="map"></div>
    </div>
  </div>
  
  <div data-role="page" data-theme="a" id="list">
    <div data-role="header" data-position="fixed" data-tap-toggle="false" data-fullscreen="false" data-theme="a">
 		  <a href="#mapIndex" data-icon="delete">Back</a>
 		  <h1>List</h1>
      <div data-role="content">
        <div data-role="collapsible-set" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d">
          <div data-role="collapsible" >
            <h3>Routes</h3>
            <ul data-role="listview" data-divider-theme="b" data-inset="true" id="route-list" />
          </div>
          <div data-role="collapsible" >
            <h3>Museums</h3>
            <ul data-role="listview" data-divider-theme="b" data-inset="true" id="museum-list" />
          </div>
          <div data-role="collapsible" >
            <h3>Monuments</h3>
            <ul data-role="listview" data-divider-theme="b" data-inset="true" id="monument-list" />
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div data-role="page" data-theme="a" id="info">
    <div data-theme="a" data-role="header">
      <a data-role="button" href="#mapIndex" class="ui-btn-left" data-icon="delete">Back</a>
      <h3>Monument Info</h3>
    </div>
    <div data-role="content">
      <h1 id="infoHeader" style="opacity:0.25; padding: 6px; background-color:black"></h1>
 		  <hr style="color:white " />
      <div style="" data-controltype="image">
        <img id="infoImage" src="" />
      </div>
 		  <hr style="color:white" />
      <div data-controltype="textblock" style="opacity:0.25; padding: 6px; background-color:black ">
        <p id="infoContent" ></p>
      </div>
    </div>
  </div>

</body>
</html>
